{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags comments fluent_comments_tags %}

{% block more_meta %}<meta name="description" content="{{ page.title }}">{% endblock %}

{% if page.css_links.all %}
    {% block extra_css %}
        <link rel="stylesheet" type="text/css" href="/static/css/ajaxcomments.css" />
        {% for link in page.css_links.all %}
            <link rel="stylesheet" type="text/css" href="{{ link.path }}">
        {% endfor%}
    {% endblock %}
{% endif %}

{% block extra_js %}
    <script type="text/javascript" src="/static/js/ajaxcomments.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    {% if page.include_mathjax %}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}});</script>
    {% endif %}

    {% for link in page.js_links.all %}
        <script type="text/javascript" src="{{ link.path }}"></script>
    {% endfor %}

    {% if page.extra_js_code %}
        <script>{{ page.extra_js_code|safe }}</script>
    {% endif %}
{% endblock %}

{% block body_class %}article-body{% endblock %}
{% include_block page.body %}

    {% block content %}

    {% block top-navigation %}{% endblock %}

    <hr>

    {% include "home/includes/info_header.html" %}
    
    <article>
        {% include "home/includes/streamfield_blocks.html" with blocks=page.body %}
    </article>

    {% get_comment_count for page as comments_count %}

    <div>
        <div id="comments-wrapper">
            {% if comments_count %}
                <h2>Comments ({{ comments_count }})</h2>
                {% render_comment_list for page %}
            {% else %}
                {% render_comment_list for page %}
            {% endif %}
          </div>

         <div id="comments-form-wrapper">
            <h2>Leave a comment</h2>
            {% render_comment_form for page %}
        </div>
    </div>

    {% if page.tags.all %}
        <h2>Tags</h2>
        {% for tag in page.tags.all %}
            <a href="/tags?tag={{ tag }}"><span class="page-tag">{{ tag }}</span></a>
        {% endfor %}
    {% endif %}

    {% block bottom-navigation %}{% endblock %}

{% endblock %}
